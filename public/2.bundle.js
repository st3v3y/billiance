(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{261:function(e,t){t.formatCurrency=function(e,t){return new Intl.NumberFormat("de-DE",{currency:t,minimumFractionDigits:2}).format(e)},t.formatDate=function(e){var t={year:"numeric",month:"2-digit",day:"2-digit"};return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(t.hour="2-digit",t.minute="2-digit"),new Intl.DateTimeFormat("de-DE",t).format(new Date(e))}},360:function(e,t){t.required=function(e){return e&&null!=e&&""!==e?void 0:"Field is required"}},364:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),l=n(18),o=n(362),i=n(24),c=n(19),u=n(21),s=n(261);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function d(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),d(this,y(t).apply(this,arguments))}var n,l,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,a["Component"]),n=t,(l=[{key:"deleteBill",value:function(e,t){var n=this;Object(c.confirmAlert)({title:"Delete Bill",message:'Do you really want to delete "'.concat(t,'"?'),buttons:[{label:"Yes",onClick:function(){return n.props.onDeleted(e)}},{label:"No"}]})}},{key:"render",value:function(){var e=this,t=this.props.bill;return r.a.createElement("div",{className:"bills-list-item"},r.a.createElement("span",{className:"date"},Object(s.formatDate)(t.asOfDate||new Date)),r.a.createElement("span",{className:"name"},t.name),r.a.createElement("span",{className:"amount"},Object(s.formatCurrency)(t.amount,t.currency)),r.a.createElement("span",{className:"currency"},t.currency),r.a.createElement(u.a,{className:"delete",onClick:function(){return e.deleteBill(t._id,t.name)},icon:"trash-alt"}))}}])&&f(n.prototype,l),o&&f(n,o),t}(),h=n(232),v=n(363);n(358);function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function g(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var O=Object(h.asField)(function(e){var t=e.fieldState.value,n=e.fieldApi,a=n.setTouched,l=n.setValue,o=g(e,["fieldState","fieldApi"]);return r.a.createElement(v.a,E({onFocus:function(){return a(!0)},onChange:function(e){return l(e)},selected:t,openToDate:t},o))}),N=n(360);function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function C(e,t,n){return t&&x(e.prototype,t),n&&x(e,n),e}function F(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?k(e):t}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,"default",function(){return _});var _=function(e){function t(e){var n;return w(this,t),(n=F(this,D(t).call(this,e))).billsDB=null,n.defaultCurrency="",n.state={bills:[],statistic:{defaultCurrency:{},otherCurrency:[],total:{amount:0,taxes:0}},exchangeRates:{},defaultCurrencySum:{},otherCurrencySums:[]},l.a.plugin(o.a),n.handleOnBillDeleted=n.handleOnBillDeleted.bind(k(k(n))),n.handleOnFormSubmit=n.handleOnFormSubmit.bind(k(k(n))),n.getBillSum=n.getBillSum.bind(k(k(n))),n}return j(t,a["Component"]),C(t,[{key:"componentWillMount",value:function(){this.billsDB=new l.a("bills");var e=this.context.getExchangeRateCacheName(),t=localStorage.getItem(e);this.defaultCurrency=this.context.defaultCurrency,this.setState({exchangeRates:JSON.parse(t)}),this.getAllBills()}},{key:"getAllBills",value:function(){var e=this,t=this.billsDB;t.createIndex({index:{fields:["clientId"]}}).then(function(){t.find({selector:{clientId:e.props.clientid}}).then(function(t){console.debug("------ GETTING ALL BILLS ---"),e.setState({bills:t.docs}),e.getBillSum()})})}},{key:"handleOnBillDeleted",value:function(e){var t=this,n=this.billsDB;n.get(e).then(function(e){return n.remove(e)}).then(function(){return t.getAllBills()})}},{key:"handleOnFormSubmit",value:function(e){console.debug("------ SUBMITTING FORM FOR NEW BILL ---"),console.log(e),e._id=(new Date).valueOf().toString(),e.clientId=this.props.clientid,this.billsDB.put(e),this.getAllBills()}},{key:"getRatesArray",value:function(){var e=[],t=this.state.exchangeRates.rates;for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e}},{key:"getBillSum",value:function(){var e=0,t=0,n=[],a=0,r=0,l=!0,o=!1,i=void 0;try{for(var c,u=this.state.bills[Symbol.iterator]();!(l=(c=u.next()).done);l=!0){var s=c.value;if(s.currency&&s.currency!==this.defaultCurrency){var m=n.find(function(e){return e.currency===s.currency}),f=parseFloat(s.amount).toFixed(2),d=(f*(parseFloat(s.taxRate)||19)/100).toFixed(2);m?(m.amount+=f,m.tax+=d):n.push({currency:s.currency,amount:f,tax:d}),a+=this.convertCurrency(s.currency,this.defaultCurrency,f),r+=this.convertCurrency(s.currency,this.defaultCurrency,d)}else{var y=parseFloat(s.amount),p=parseFloat(s.taxRate||19);e+=y,t+=y*p/100}}}catch(e){o=!0,i=e}finally{try{l||null==u.return||u.return()}finally{if(o)throw i}}a+=e,r+=t,this.setState({statistic:{defaultCurrency:{amount:e.toFixed(2),tax:t.toFixed(2),currency:this.defaultCurrency},otherCurrency:n,total:{amount:a.toFixed(2),taxes:r.toFixed(2)}}})}},{key:"convertCurrency",value:function(e,t,n){if(e!==this.defaultCurrency&&t!==this.defaultCurrency)throw Error("One of the currencies has to be the defauly currency");return console.debug("------ CONVERTING FROM ",e," to ",t," ---"),e===this.defaultCurrency?n*parseFloat(this.state.exchangeRates.rates[t]):n/parseFloat(this.state.exchangeRates.rates[e])}},{key:"render",value:function(){var e=this,t=this.state.bills.map(function(t,n){return r.a.createElement(b,{key:t._id,bill:t,onDeleted:e.handleOnBillDeleted,onUpdateSubmit:e.onUpdateSubmit})});return r.a.createElement("div",{className:"bills-list-container"},r.a.createElement("div",{className:"bills-list"},t,this.state.bills.length>0?r.a.createElement(R,{data:this.state.statistic}):r.a.createElement("span",null,"No bills")),r.a.createElement("div",{className:"add-bill-container"},r.a.createElement("button",{className:"add-bill button",onClick:function(){return e._form.toggleShow()}},"Add Bill"),r.a.createElement("div",{className:"add-bill-form-container",style:{display:"none"},ref:function(t){return e._form=t}},r.a.createElement(h.Form,{id:"simple-form",onSubmit:this.handleOnFormSubmit,className:"add-bill-form"},function(t){var n=t.formState;return r.a.createElement("div",{className:"add-bill-form-inner"},r.a.createElement("div",{className:"column-left column"},r.a.createElement("div",{className:"field"},r.a.createElement("label",{htmlFor:"name-field"},"Name"),r.a.createElement(h.Text,{field:"name",id:"name-field",validate:N.required,validateOnBlur:!0,className:n.errors.name?"error":""}),n.errors.name&&r.a.createElement("span",{className:"error"},n.errors.name)),r.a.createElement("div",{className:"field"},r.a.createElement("label",{htmlFor:"asofdate-field"},"Date"),r.a.createElement(O,{field:"asOfDate",id:"asofdate-field",validate:N.required})),r.a.createElement("div",{className:"field"},r.a.createElement("label",{htmlFor:"amount-field"},"Amount"),r.a.createElement(h.Text,{field:"amount",id:"amount-field"}),r.a.createElement(h.Select,{field:"currency",id:"currency-field",initialValue:e.defaultCurrency},r.a.createElement(h.Option,{value:e.state.exchangeRates.base},e.state.exchangeRates.base),e.getRatesArray().map(function(e,t){return r.a.createElement(h.Option,{key:t,value:e},e)}))),n.invalid&&r.a.createElement("div",{className:"form-validation-errors"},Object.keys(n.errors).map(function(e){return r.a.createElement("li",null,e,": ",n.errors[e])})),r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{type:"submit",className:"button"},"Submit"),r.a.createElement("button",{className:"button",onClick:function(t){e._form.toggleShow(),t.preventDefault()}},"Cancel"))),r.a.createElement("div",{className:"column-right column"},r.a.createElement("div",{className:"field"},r.a.createElement("label",{htmlFor:"desc-bio"},"Notes"),r.a.createElement(h.TextArea,{field:"desc",id:"desc-bio",rows:"6"}))))}))))}}]),t}();_.contextType=i.a,_.contextType=i.a;var R=function(e){function t(){return w(this,t),F(this,D(t).apply(this,arguments))}return j(t,a["Component"]),C(t,[{key:"render",value:function(){var e=this.props.data,t=e.otherCurrency.map(function(e,t){return r.a.createElement("span",{key:t},r.a.createElement("span",{className:"amount"},e.amount),r.a.createElement("span",{className:"div"}," / "),r.a.createElement("span",{className:"netto"},e.tax),r.a.createElement("span",{className:"currency"},e.currency))}),n=e.defaultCurrency;return r.a.createElement("div",{className:"bill-sum"},e.otherCurrency.length>0&&r.a.createElement("span",null,r.a.createElement("div",{className:"other-currencies"},t),r.a.createElement("div",{className:"default-currency"},r.a.createElement("span",{className:"amount"},n.amount),r.a.createElement("span",{className:"div"}," / "),r.a.createElement("span",{className:"netto"},n.tax),r.a.createElement("span",{className:"currency"},n.currency))),r.a.createElement("div",{className:"total"},r.a.createElement("span",{className:"amount"},e.total.amount),r.a.createElement("span",{className:"div"}," / "),r.a.createElement("span",{className:"netto"},e.total.taxes),r.a.createElement("span",{className:"currency"},n.currency)))}}]),t}()}}]);